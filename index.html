<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>lightbug.io</title>
    <script src="lib/phaser.min.js"></script>
    <script src="src/pellet.js"></script>
    <script src="src/lightbug.js"></script>
    <script src="src/playerbug.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };
    
    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

    function preload ()
    {
        game.load.image('ground', 'assets/cavefloor.png');
        game.load.image('sball', 'assets/sball.png')
        game.load.image('firefly', 'assets/firefly.png');
        game.load.physics('firefly_physics', 'assets/firefly_physics.json');
    }

    var playerbug;
    var pelletManager;
    var lightbugManger;
    var pelletHit = 0;
    var text;


    function create ()
    {
        //world size
        game.world.setBounds(0, 0, 4000, 4000);
        game.scale.scaleMode = Phaser.ScaleManager.RESIZE;

        //enable p2 physics
        game.physics.startSystem(Phaser.Physics.P2JS);
        //game.physics.p2.restitution = 0.8;

        //turn on impact events for the world for collision callbacks
        game.physics.p2.setImpactEvents(true);

        //background
        var background = game.add.tileSprite(0, 0, 4000, 4000, 'ground');

        //pellets collected
        text = game.add.text(0, 0, "pellets hit: 0", { font: "65px Arial", fill: "#ff0044", align: "center" });

        pelletManager = new Pellet(game);
        lightbugManger = new Lightbug(game);

        pelletManager.collidesWith([pelletManager.cGroup, lightbugManger.cGroup]);
        lightbugManger.collidesWith([[pelletManager.cGroup, Lightbug.hitPellet], [lightbugManger.cGroup, undefined]]);

        playerbug = lightbugManger.createLightbug(400, 300);
        playerbug = new Playerbug(game, playerbug);

        game.camera.follow(playerbug.player);

        pelletManager.generatePellets(80, 10);
        lightbugManger.createLightbug(200, 800);

        //circle barrier
        //var circle = game.add.graphics();
        //circle.lineStyle(2, 0xFF0000, 1);
        //circle.beginFill(0xFF0000, 1);
        //circle.drawCircle(game.world.centerX, game.world.centerY, 550);
        //game.physics.p2.enable(circle);
        //circle.body.setCircle(225);
        //circle.body.static = true;
        
    }

    function update ()
    {
        playerbug.move();
        pelletManager.rewardConsumers();
    }


</script>

</body>
</html>